<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Weather Map Project</title>
    <link href="https://fonts.googleapis.com/css?family=Anonymous+Pro|Ubuntu" rel="stylesheet">
    <style>
        body {
            /*background-image: url("IMG/Weatherbkgrnd.png");*/
            background: #e5e5e5;
            font-family: 'Anonymous Pro', monospace;
            margin: 0;
            font-size: 1.29vw;
        }
        main {
            width: 80%;
            margin: 0 auto;
            text-align: center;
            background: #e5e5e5;
        }
        h1 {
            text-align: center;
            font-family: 'Ubuntu', sans-serif;
            font-size: 2.0833333333333335vw;
            padding: 0.6944444444444444vw;
            display: inline;
        }
        p {
            line-height: 1;
            margin: .5vw;
        }
        .instruct {
            margin: 1vw;
            font-weight: bolder;
        }
        .city {
            display: block;
            margin: 0;
        }
        select {
            height: 2.2222222222222223vw;
            background: #e5e5e5;
            font-size: 1.1111111111111112vw;
            border-radius: 5px;
            float: right;
            font-family: 'Anonymous Pro', monospace;
        }
        select:hover {
            background: #C0DDEF;
            color: #182038;
        }
        .checkboxes {
            text-align: right;
        }
        .top {
            background: black;
            color: white;
            padding: 0.6944444444444444vw;
        }
        .inner {
            width: 80%;
            margin: 0 auto;
        }
        .headers {
            text-align: center;
            width: 100%;
            height: auto;
            display: flex;
        }
        .header {
            background: #182038;
            height: auto;
            text-align: center;
            border: 1px solid black;
            color: #F8ECE8;
            padding: .5vw;
            margin: 0.6944444444444444vw .3vw;
            border-radius: 5px;
            flex: 1;
        }
        .headerSmall {
            display: none;
        }
        .weather {
            display: flex;
            height: auto;
            clear: right;
        }
        .day {
            background: #C0DDEF;
            text-align: center;
            border: 1px solid black;
            color: #182038;
            border-radius: 5px;
            margin: 0 .3vw;
            flex: 1;
        }
        .day h3 {
            margin: .75vw 0;
        }
        .gifSize {
            height: 5.208333333333333vw;
        }
        #map{
            width: 100%;
            height: 27.77777777777778vw;
            border: 3px solid #182038;
            border-radius: 5px;
            margin-bottom: 3vw;
            box-sizing: border-box;
        }
        #logo {
            height: 2.0833333333333335vw;
        }
        @media screen and (max-width: 1000px) {
            body {
                font-size: 1.75vw;
            }
            main {
                width: 90%;
            }
            h1 {
                font-size: 5vw;
                padding: 1vw;
            }
            h3 {
                margin: 2vw;
            }
            .day p {
                line-height: 1.75vw;
                margin: 1vw;
            }
            select {
                height: 4vw;
                font-size: 2vw;
                margin: 2vw 0;
            }
            .top {
                padding: 2vw;
            }
            .inner {
                width: 90%;
            }
            .checkboxes {
                margin: 1.5vw 0;
            }
            .instruct {
                margin: 2vw;
            }
            .gifSize {
                height: 10vw;
            }
            .header {
                height: 2.5vw;
                padding-top: .5vw;
                margin-top: 2vw;
                font-size: 2vw;
            }
            #logo {
                height: 5vw;
            }
            #map{
                height: 60vw;
            }
        }
        @media screen and (max-width: 550px) {
            body {
                font-size: 4vw;
            }
            main {
                width: 95%;
            }
            h1 {
                font-size: 6.8vw;
                padding: 2vw;
            }
            h3 {
                margin: 2vw;
            }
            .day p {
                line-height: 5vw;
                margin: auto;
            }
            select {
                height: 6.8vw;
                font-size: 3.4vw;
                float: none;
                margin: 2vw;
            }
            .top {
                padding: 2vw;
            }
            .inner {
                width: 98%;
                text-align: center;
            }
            .gifSize {
                height: 20vw;
            }
            .day {
                flex: 0;
                margin: 2vw 0;
            }
            .instruct {
                margin: 3.5vw;
            }
            .checkboxes{
                text-align: center;
            }
            .checkboxes label {
                display: block;
            }
            .headers {
                display: none;
            }
            .headerSmall {
                display: block;
                font-size: 4vw;
                height: auto;
            }
            .weather {
                display: block;
            }
            #logo {
                height: 6.8vw;
            }
            #map{
                height: 60vw;
            }
        }
    </style>
</head>
<body>
<div class="top">
    <div class="inner">
        <img id="logo" src="IMG/weather-sun.png">
        <h1>Weather Project</h1>
        <!--<input type="text" placeholder="Latitude" id="latitude">-->
        <!--<input type="text" placeholder="Longitude" id="longitude">-->
        <!--<button id="latlon">Search!</button>-->
        <select name="daysNumber" id="daysNumber" class="button">
            <option value="1">1-Day Forecast</option>
            <option value="3" selected>3-Day Forecast</option>
            <option value="4">4-Day Forecast</option>
            <option value="5">5-Day Forecast</option>
        </select>
        <div class="checkboxes">
            <label><input type="checkbox" id="iconShow" name="description" checked>Icon</label>
            <label><input type="checkbox" id="descriptionShow" name="description" checked>Description</label>
            <label><input type="checkbox" id="humidityShow" name="description" checked>Humidity</label>
            <label><input type="checkbox" id="windShow" name="description" checked>Wind</label>
            <label><input type="checkbox" id="pressureShow" name="description" checked>Pressure</label>
        </div>
    </div>
</div>
<main>
    <h1 class="city"></h1>
    <div class="headers"></div>
    <div class="weather"></div>
    <p class="instruct">Click on the map for the weather!</p>
    <div id="map"></div>

</main>

<script src="js/jquery-2.2.4.js"></script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCA12FJ0Fsb0QXncRWVWlF1M2UIPTn0VB8"></script>
<script>
    $("document").ready(function() {
        var markers = [];
        var geoLat = 29.4241;
        var geoLon = -98.4936;
        update();
        var map = new google.maps.Map(document.getElementById("map"), {
            center: {lat: geoLat, lng: geoLon},
            zoom: 5
        });
        google.maps.event.addListener(map, 'click', function (event) {
            clickMarker(event.latLng, map);
            //map.setCenter({lat: geoLat, lng: geoLon});
        });
        $("#daysNumber").on("change", update);
        $(".checkboxes").on("click", update);
        function clickMarker(location, map) {
            clearMarkers();
            var marker = new google.maps.Marker({
                position: location,
                map: map,
                icon: 'IMG/weather-sun.png'
            });
            markers.push(marker);
            var geocoder = new google.maps.Geocoder();
            geoLat = location.lat();
            geoLon = location.lng();
            // $("#latitude").val(geoLat.toFixed(3));
            // $("#longitude").val(geoLon.toFixed(3));
            update(geoLat, geoLon);
            // $("#latitude").val("");
            // $("#longitude").val("");
        }
        function clearMarkers() {
            setMapOnAll(null);
        }
        function setMapOnAll(map) {
            for (var i = 0; i < markers.length; i++) {
                markers[i].setMap(map);
            }
        }
        function update() {
            // var latitude = 29.4241;
            // var longitude = -98.4936;
            // if ($("#latitude").val() !== "" && $("#longitude").val() !== "") {
            //     latitude = $("#latitude").val();
            //     longitude = $("#longitude").val();
            // }
            $.get("http://api.openweathermap.org/data/2.5/forecast", {
                APPID: "7c66dda135d5bd2e458cb66254bd830b",
                lat: geoLat,
                lon: geoLon,
                units: "imperial"
            }).done(function (weather) {
                console.log(weather);
                var html = "";
                var htmlheaders = "";
                var city = "";
                var tempMaxArray = [];
                var tempMinArray = [];
                var humidityArray = [];
                var windArray = [];
                var pressureArray = [];
                var dateArray = [];
                var counter = 0;
                weather.list.forEach(function(temp){
                    var date = new Date((temp.dt * 1000)-21600);
                    dateArray.push(date.getDay());
                    tempMaxArray.push(Math.round(temp.main.temp_max));
                    tempMinArray.push(Math.round(temp.main.temp_min));
                    humidityArray.push(temp.main.humidity);
                    windArray.push(temp.wind.speed);
                    pressureArray.push(temp.main.grnd_level);
                });
                for(var l = 0; l <dateArray.length; l++){
                    if(dateArray[0] === dateArray[l]){
                        counter++;
                    }
                }
                for (var i = 0; i <= (($("#daysNumber").val()-1)*8); i += 8) {
                    var weatherGif = "";
                    var daysArray = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
                    var tempMin, tempMax, humidity, wind, pressure;
                    switch(weather.list[i].weather[0].description){
                        case "sky is clear":
                            weatherGif = "https://media.giphy.com/media/Az9wuw2NHfNzG/giphy.gif";
                            break;
                        case "clear sky":
                            weatherGif = "https://media.giphy.com/media/Az9wuw2NHfNzG/giphy.gif";
                            break;
                        case "few clouds":
                            weatherGif = "https://media.giphy.com/media/3ov9jLYWb4zCjGfqIE/giphy.gif";
                            break;
                        case "scattered clouds":
                            weatherGif = "https://media.giphy.com/media/1iPwXyVKrKf0dNmM/giphy.gif";
                            break;
                        case "broken clouds":
                            weatherGif = "https://media.giphy.com/media/3ohhwsupwJyzktdgS4/giphy.gif";
                            break;
                        case "light rain":
                            weatherGif = "https://media.giphy.com/media/88wGX2Yfl6Z7q/giphy.gif";
                            break;
                        case "rain":
                            weatherGif = "https://media.giphy.com/media/1tt1PaVgsvlYs/giphy.gif";
                            break;
                        case "moderate rain":
                            weatherGif = "https://media.giphy.com/media/EEFEyXLO9E0YE/giphy.gif";
                            break;
                        case "heavy intensity rain":
                            weatherGif = "https://media.giphy.com/media/VBx2As74m5k0U/giphy.gif";
                            break;
                        case "thunderstorm":
                            weatherGif = "https://media.giphy.com/media/3ohhwHGift6jATwg4o/giphy.gif";
                            break;
                        case "snow":
                            weatherGif = "https://media.giphy.com/media/h5SbEEFpDs84U/giphy.gif";
                            break;
                        case "light snow":
                            weatherGif = "https://media.giphy.com/media/7tYNMJ29GcbE4/giphy.gif";
                            break;
                        case "heavy snow":
                            weatherGif = "https://media.giphy.com/media/oiqK7WB2J76uc/giphy.gif";
                            break;
                        case "overcast clouds":
                            weatherGif = "https://media.giphy.com/media/Zjj86hg7vHeve/giphy.gif";
                            break;
                    }
                    if (i === 0) {
                        htmlheaders += "<div class='header'>Current</div>";
                        html += "<div class='headerSmall header'>Current</div>";
                        tempMax = Math.max(...tempMaxArray.slice(i, counter));
                        tempMin = Math.min(...tempMinArray.slice(i, counter));
                        humidity = humidityArray.slice(i, counter).reduce((a,b) => a+b)/counter;
                        wind = windArray.slice(i, counter).reduce((a,b) => a+b)/counter;
                        pressure = pressureArray.slice(i, counter).reduce((a,b) => a+b)/counter;
                    } else {
                        htmlheaders += "<div class='header'>" + daysArray[dateArray[i]] + "</div>";
                        html += "<div class='headerSmall header'>" + daysArray[dateArray[i]] + "</div>";
                        tempMax = Math.max(...tempMaxArray.slice(i, i+8));
                        tempMin = Math.min(...tempMinArray.slice(i, i+8));
                        humidity = humidityArray.slice(i, i+8).reduce((a,b) => a+b)/8;
                        wind = windArray.slice(i, i+8).reduce((a,b) => a+b)/8;
                        pressure = pressureArray.slice(i, i+8).reduce((a,b) => a+b)/8;
                    }
                    html += "<div class='day'><h3>" + tempMax + "°/" + tempMin + "°F" + "</h3>";
                    //html += "<img src='http://openweathermap.org/img/w/" + weather.list[i].weather[0].icon + ".png'>";
                    if($("#iconShow").prop('checked')) {
                        html += "<img class='gifSize' src='" + weatherGif + "'>";
                    }
                    if($("#descriptionShow").prop('checked')) {
                        html += "<p>" + weather.list[i].weather[0].main + ": " + weather.list[i].weather[0].description + "</p>";
                    }
                    if($("#humidityShow").prop('checked')) {
                        html += "<p>Humidity: " + Math.round(humidity) + "%</p>";
                    }
                    if($("#windShow").prop('checked')) {
                        html += "<p>Wind: " + Math.round(wind) + " mph</p>";
                    }
                    if($("#pressureShow").prop('checked')) {
                        html += "<p>Pressure: " + Math.round(pressure) + " hPa</p>";
                    }
                    html += "</div></div>";
                    if(i === 0){
                        i = counter-8;
                    }
                }
                if (weather.city.name) {
                    city = weather.city.name;
                } else {
                    city = "Somewhere in the World";
                }
                $(".city").html(city);
                $(".headers").html(htmlheaders);
                $(".weather").html(html);
            }).fail(function () {
                $(".city").html("No such place!");
                $(".weather").html("<p>Please try a different location.</p>");
            });
        }
        // $("#latlon").click(function (event) {
        //     event.preventDefault();
        //     update();
        //     $("#latitude").val("");
        //     $("#longitude").val("");
        // });
    });

</script>
</body>
</html>